---
title: Java Review 3
tags: [Java]
---

## 运算简写
```
n += 100;
n -= 100;

n++;
n--;
```

## 移位运算
可以对整数进行移位运算。对整数7左移1位将得到整数14，左移两位将得到整数28：
```
int n = 7;       // 00000000 00000000 00000000 00000111 = 7
int a = n << 1;  // 00000000 00000000 00000000 00001110 = 14
int b = n << 2;  // 00000000 00000000 00000000 00011100 = 28
int c = n << 28; // 01110000 00000000 00000000 00000000 = 1879048192
int d = n << 29; // 11100000 00000000 00000000 00000000 = -536870912
```

还有一种无符号的右移运算，使用 `>>>`，它的特点是不管符号位，右移后高位总是补0，因此，对一个负数进行 `>>>` 右移，它会变成正数，原因是最高位的1变成了0：
```
int n = -536870912;
int a = n >>> 1;  // 01110000 00000000 00000000 00000000 = 1879048192
int b = n >>> 2;  // 00111000 00000000 00000000 00000000 = 939524096
int c = n >>> 29; // 00000000 00000000 00000000 00000111 = 7
int d = n >>> 31; // 00000000 00000000 00000000 00000001 = 1
```

对 `byte` 和 `short` 类型进行移位时，会首先转换为 `int` 再进行位移。仔细观察可发现，左移实际上就是不断地 `×2`，右移实际上就是不断地 `÷2`。

## 位运算
```
n = 0 & 0; // 0
n = 0 | 1; // 1

#非运算
n = ~0; // 1

#异或运算，如果两个数不同，结果为1，否则为0
n = 0 ^ 0; // 0
```

对两个整数进行位运算，实际上就是按位对齐，然后依次对每一位进行运算。

## 类型自动提升与强制转型
在运算过程中，如果参与运算的两个数类型不一致，那么计算结果为较大类型的整型。例如，`short` 和 `int` 计算，结果总是 `int`，原因是 `short` 首先自动被转型为 `int`。

也可以将结果强制转型，即将大范围的整数转型为小范围的整数。例如，将 `int` 强制转型为 `short`：
```
int i = 12345;
short s = (short) i; // 12345
```

要注意，超出范围的强制转型会得到错误的结果，原因是转型时，`int` 的两个高位字节直接被扔掉，仅保留了低位的两个字节。

## 浮点数运算
在计算机中，浮点数虽然表示的范围大，但是，浮点数有个非常重要的特点，就是浮点数常常无法精确表示。浮点数 `0.1` 在计算机中就无法精确表示，因为十进制的 `0.1` 换算成二进制是一个无限循环小数，很显然，无论使用 `float` 还是 `double`，都只能存储一个 `0.1` 的近似值。但是，`0.5` 这个浮点数又可以精确地表示。因为浮点数常常无法精确表示，因此，浮点数运算会产生误差。

由于浮点数存在运算误差，所以比较两个浮点数是否相等常常会出现错误的结果。正确的比较方法是判断两个浮点数之差的绝对值是否小于一个很小的数：
```
// 比较x和y是否相等，先计算其差的绝对值:
double r = Math.abs(x - y);
// 再判断绝对值是否足够小:
if (r < 0.00001) {
    // 可以认为相等
} else {
    // 不相等
}
```

浮点数在内存的表示方法和整数比更加复杂。Java 的浮点数完全遵循 `IEEE-754` 标准，这也是绝大多数计算机平台都支持的浮点数标准表示方法。

如果参与运算的两个数其中一个是整型，那么整型可以自动提升到浮点型。在一个复杂的四则运算中，两个整数的运算不会出现自动提升的情况。例如：
```
double d = 1.2 + 24 / 5; // 5.2
```

整数运算在除数为0时会报错，而浮点数运算在除数为0时，不会报错，但会返回几个特殊值：
- `NaN` 表示 Not a Number
- `Infinity` 表示无穷大
- `-Infinity` 表示负无穷大

```
double d1 = 0.0 / 0; // NaN
double d2 = 1.0 / 0; // Infinity
double d3 = -1.0 / 0; // -Infinity
```

## 强制转型
可以将浮点数强制转型为整数。在转型时，浮点数的小数部分会被丢掉。如果转型后超过了整型能表示的最大范围，将返回整型的最大值。例如：
```
int n1 = (int) 12.3; // 12
int n2 = (int) 12.7; // 12
int n2 = (int) -12.7; // -12
int n3 = (int) (12.7 + 0.5); // 13
int n4 = (int) 1.2e20; // 2147483647
```

如果要进行四舍五入，可以对浮点数加上 `0.5` 再强制转型。

## 布尔运算
对于布尔类型 `boolean`，永远只有 `true` 和 `false` 两个值。布尔运算的一个重要特点是短路运算。

```
boolean isGreater = 5 > 3; // true
int age = 12;
boolean isZero = age == 0; // false
boolean isNonZero = !isZero; // true
boolean isAdult = age >= 18; // false
boolean isTeenager = age >6 && age <18; // true
```

## 三元运算符
Java 还提供一个三元运算符 `b ? x : y`，它根据第一个布尔表达式的结果，分别返回后续两个表达式之一的计算结果。示例：
```
public class Main {
    public static void main(String[] args) {
        int n = -100;
        int x = n >= 0 ? n : -n;
        System.out.println(x);
    }
}
```

## References
- [廖雪峰的官方网站](https://www.liaoxuefeng.com/wiki/1252599548343744/1255938640048480)
